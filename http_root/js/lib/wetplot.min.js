var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";
var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");$jscomp.polyfill("Number.parseInt",function(a){return a||parseInt},"es6","es3");
var DEFAULT_LINE_CODE="###default###",WETPLOT_CSS="\n    .xAxisText {\n        fill: #000000;\n    }\n\n    .linePath {\n        fill: none;\n    }\n\n    .grid {\n        fill: none;\n        stroke: #666;\n    }\n\n    #hoverCursor {\n        stroke: #000;\n    }\n\n    .wetplot-button {\n        height: 2rem;\n        width: 2rem;\n        font-size: 1.8rem;\n        background-color: #aaaaaaaa;\n        text-align: center;\n        vertical-align: center;\n        margin-top: 0.25rem;\n        margin-left: 0.25rem;\n    }\n\n    .wetplot-button:hover {\n        background-color: #ccccccaa;\n    }\n\n    .wetplot-button:not(:last-child) {\n        margin-right: 0.25rem;\n    }\n\n    #wetplot-button-container {\n        z-index: 100;\n    }\n",COLOR_PALETTES=
[["#ff0000","#00ff00","#00ffff","#0000ff","#ff00ff"],"#ff0000 #ff8000 #80ff00 #00ff00 #00ff80 #00ffff #0080ff #0000ff #8000ff #ff00ff #ff0080".split(" ")],TEXTS={TIME:{en:"Time",de:"Zeit",fr:"Temps"},VISIBLE_LINES:{en:"Visible Lines",de:"Sichtbare Linien",fr:"Lignes visibles"}};
function getText(a){var b=TEXTS[a];if(void 0===b)return"###"+a+"###";a=Object.getOwnPropertyNames(b);for(var c,d=!1,e=0;e<window.navigator.languages.length;e++)if(c=window.navigator.languages[e],c.startsWith("en")&&(c="en"),c in a){d=!0;break}d||(c=a[0]);return b[c]}function createSvgElement(a){return document.createElementNS("http://www.w3.org/2000/svg",void 0===a?"svg":a)}function _split_to_digits(a){for(var b=[];a;)b.push(a%10),a=Math.floor(a/10);b.reverse();return b}
var Wetplot=function(){this._config={rows:[],container_id:"wetplot-container",width:1E3,height:500,background_color:"#c7c1a7",hover_box_background_color:"#fafafa",time_offset:Math.round((+new Date-864E5)/1E3),time_length:86400,seconds_per_pixel:60,seconds_per_grid_line:3600,num_horizontal_grid_lines:20,caching_enabled:!1,db_name:"wetplot",intervals:{"10min":600,hour:3600,day:86400,week:604800,month:2678400,year:31536E3},allow_scrolling_to_far:!1,font_size_px:16,show_line_visibility_button:!0,show_zoom_buttons:!0};
this._line_config={"###default###":{type:"line",color:"#000000",line_width:1,name:"?",unit:"1",auto_min_max:!1,min:0,max:10,visible:!0}};this._data=null;this._x_offset=0;this._data_callback=null};
Wetplot.prototype.initialize=function(){this._svgElement=createSvgElement("svg");this._wrapperElement=document.getElementById(this._config.container_id);this._wrapperElement.appendChild(this._svgElement);this._wrapperElement.style.height=this._config.height+"px";this._wrapperElement.style.display="flex";this._svgElement.style.pointerEvents="none";this._svgElement.style.position="block";this._svgElement.style.width=this._config.width+"px";this._svgElement.style.height=this._config.height+"px";this._svgElement.style["background-color"]=
this._config.background_color;this._svgElement.setAttribute("width",this._config.width);this._svgElement.setAttribute("height",this._config.height);this._svgElement.setAttribute("viewBox","0 0 "+this._config.width+" "+this._config.height);this._add_style();this._addPanEventListeners();this._openDb();this._set_auto_min_max();this._rebuildAllLines();this._create_y_axis();this._redraw_x_axis();this._redraw_horizontal_grid();this._createHoverCursor();this._show_buttons()};
Wetplot.prototype._openDb=function(a){a=void 0===a?function(d){}:a;var b=window.indexedDB.open(this._config.db_name,1),c=Object.getOwnPropertyNames(this._config.intervals);b.onerror=function(d){console.error(d.target.errorCode)};b.onsuccess=function(d){a(d.target.result)};b.onupgradeneeded=function(d){console.log("DB update needed");var e=d.target.result;c.forEach(function(f){e.createObjectStore(f,{keyPath:"Time"})})}};
Wetplot.prototype._addDataToDb=function(a,b){this._openDb(function(c){function d(f){console.debug("Add "+JSON.stringify(f));e.add(f)}c=c.transaction([a],"readwrite");var e=c.objectStore(a);b.forEachObject(function(f){var g=e.get(f.Time);g.onsuccess=function(h){h=g.result;if(void 0===h)d(f);else{var l=JSON.stringify(h);Object.assign(h,f);var k=JSON.stringify(h);l!==k&&(console.debug("Update "+l),e.put(h))}};g.onerror=function(h){d(f)}});c.onabort=function(f){console.error(f)}})};
Wetplot.prototype._getDataFromDb=function(a,b,c,d){this._openDb(function(e){var f=e.transaction(a).objectStore(a).getAll(IDBKeyRange.bound(b,c));f.onsuccess=function(g){d(WetplotData.fromObjectArray(f.result))}})};
Wetplot.prototype._request_data=function(a,b,c){var d=this;this._getDataFromDb(a,b,c,function(e){d._data=WetplotData.concatenate(d._data,e);null!==d._data_callback&&d._data.getMissingTimespans(b,c,600).forEach(function(f){var g=$jscomp.makeIterator(f);f=g.next().value;g=g.next().value;d._data_callback(a,f,g,function(h){d._addDataToDb(a,h);d._data=WetplotData.concatenate(d._data,h);d._redraw_all()})})})};
Wetplot.prototype._add_style=function(){var a=document.createElement("style");a.textContent=WETPLOT_CSS;document.head.append(a)};
Wetplot.prototype._redraw_x_axis=function(){var a=document.getElementById("xAxisGroup");null===a&&(a=createSvgElement("g"),a.setAttribute("id","xAxisGroup"),this._svgElement.appendChild(a));var b=document.getElementById("xAxisGridPath");null===b&&(b=createSvgElement("path"),b.classList.add("grid"),b.setAttribute("id","xAxisGridPath"),this._svgElement.appendChild(b));for(var c=a.innerHTML="",d=this._config.seconds_per_grid_line,e=this._config.time_offset,f=this._config.font_size_px,g=Math.round(e/
d)*d;g<e+this._config.time_length;g+=d){var h=new Date(1E3*g),l=Math.round(this._seconds_to_x_coords(g));h=h.toLocaleString();var k=h.lastIndexOf(":");h=h.substring(0,k)+h.substring(k+3,h.length);k=createSvgElement("text");k.innerHTML=h;k.setAttribute("x",0);k.setAttribute("y",f/4);k.setAttribute("transform","rotate(90,0,0) translate(10 "+-l+")");k.style.fontSize=f+"px";k.classList.add("xAxisText");a.appendChild(k);c+="M"+l+" 0 V "+this._config.height}b.setAttribute("d",c)};
Wetplot.prototype._redraw_horizontal_grid=function(){for(var a="",b=this._config.num_horizontal_grid_lines,c=this._config.height/(b+1),d=1;d<=b;d++)a+="M 0 "+Math.round(c*d)+" H "+this._getXmax();b=document.getElementById("horizontalGrid");null===b&&(b=createSvgElement("path"),b.setAttribute("id","horizontalGrid"),b.classList.add("grid"),this._svgElement.appendChild(b));b.setAttribute("d",a)};Wetplot.prototype._rebuildAllLines=function(){var a=this;this.getAllLineCodes().forEach(function(b){return a._rebuildLine(b)})};
Wetplot.prototype._set_auto_min_max=function(){var a=this,b=[],c={},d=this._data.heads.indexOf("Time");this.getVisibleLineCodes().forEach(function(p){var r=a._line_config[p].unit;-1===b.indexOf(r)?(b.push(r),c[b.length-1]=[p]):c[b.indexOf(r)].push(p)});for(var e={},f=0;f<b.length;e={$jscomp$loop$prop$min$15:e.$jscomp$loop$prop$min$15,$jscomp$loop$prop$max$16:e.$jscomp$loop$prop$max$16},f++){var g=c[f],h=g.filter(function(p){return a._line_config[p].auto_min_max});e.$jscomp$loop$prop$min$15=Infinity;
e.$jscomp$loop$prop$max$16=-Infinity;g=$jscomp.makeIterator(g);for(var l=g.next();!l.done;l=g.next()){var k=l.value;if(this._line_config[k].auto_min_max){var m=this._line_config[k].type;l=this._data.heads.indexOf(k);if("line"===m)k=$jscomp.makeIterator(this._data.getMinMaxForColumn(l)),l=k.next().value,k=k.next().value,e.$jscomp$loop$prop$min$15=Math.min(e.$jscomp$loop$prop$min$15,l),e.$jscomp$loop$prop$max$16=Math.max(e.$jscomp$loop$prop$max$16,k);else if("ybar"===m){k=void 0;for(var n=m=0;n<this._data.values.length;n++){var q=
this.changingPropertyForYBarLines(this._data.values[n][d]);void 0!==k&&k!==q&&(e.$jscomp$loop$prop$min$15=Math.min(e.$jscomp$loop$prop$min$15,m),e.$jscomp$loop$prop$max$16=Math.max(e.$jscomp$loop$prop$max$16,m),m=0);m+=this._data.values[n][l];k=q}}else throw Error('unsupported line type "'+m+'" for line "'+k+'"');}else e.$jscomp$loop$prop$min$15=Math.min(e.$jscomp$loop$prop$min$15,this._line_config[k].min),e.$jscomp$loop$prop$max$16=Math.max(e.$jscomp$loop$prop$max$16,this._line_config[k].max)}h.forEach(function(p){return function(r){a._line_config[r].min=
p.$jscomp$loop$prop$min$15;a._line_config[r].max=p.$jscomp$loop$prop$max$16}}(e))}};
Wetplot.prototype._rebuildLine=function(a){var b=this._data.heads.indexOf(a),c=this._data.heads.indexOf("Time"),d=this._line_config[a],e="",f=!1;if(d.visible)if("line"===d.type){e="M";for(var g=!0,h=0;h<this._data.values.length;h++){var l=this._seconds_to_x_coords(this._data.values[h][c]),k=this._value_to_y_coord(a,this._data.values[h][b]);g?g=!1:e+=" L";e+=" "+Math.round(l)+" "+Math.round(k)}}else if("ybar"===d.type){f=!0;e=void 0;k=h=this._config.time_offset;l=0;g=[];for(var m=0;m<this._data.values.length;m++){var n=
this._data.values[m][c],q=this.changingPropertyForYBarLines(n);void 0!==e&&e!==q&&(g.push([h,k,l]),h=n,l=0);l+=this._data.values[m][b];e=q;k=n}b=this._value_to_y_coord(a,0);e="M 0 "+b;for(c=0;c<g.length;c++)h=g[c][0],k=g[c][1],l=g[c][2],l=this._value_to_y_coord(a,l),h=this._seconds_to_x_coords(h)+1,k=this._seconds_to_x_coords(k)-1,e+=" H "+h,e+=" V "+l,e+=" H "+k,e+=" V "+b;e+=" Z"}else console.error("Unknown type for line "+a+': "'+d.type+'"');console.debug(e);g=document.getElementById("path"+a);
null===g&&(g=createSvgElement("path"),this._svgElement.appendChild(g),g.classList.add("linePath"),g.setAttribute("id","path"+a));g.style.stroke=d.color;g.style.strokeWidth=d.line_width;f&&(g.style.fill=d.color,g.style.fillOpacity=.4);g.setAttribute("d",e)};Wetplot.prototype.changingPropertyForYBarLines=function(a){return Math.floor(a/this._config.seconds_per_grid_line)};
Wetplot.prototype._create_y_axis=function(){this._yAxisElement=createSvgElement("svg");this._wrapperElement.appendChild(this._yAxisElement);this._yAxisElement.setAttribute("width","0.01em");this._redraw_y_axis()};
Wetplot.prototype._redraw_y_axis=function(){var a=this,b=this._config.font_size_px,c=this._get_visible_units();this._yAxisElement.setAttribute("height",this._config.height);this._yAxisElement.setAttribute("width",4*c.length*b+"px");this._yAxisElement.style.backgroundColor=this._config.background_color;this._yAxisElement.innerHTML="";for(var d={},e=0;e<c.length;d={$jscomp$loop$prop$unit$18:d.$jscomp$loop$prop$unit$18},e++){d.$jscomp$loop$prop$unit$18=c[e];var f="group"+this._unit_to_id(d.$jscomp$loop$prop$unit$18),
g=this.getVisibleLineCodes().filter(function(t){return function(u){return a._line_config[u].unit===t.$jscomp$loop$prop$unit$18}}(d));console.log("creating y axis for unit "+d.$jscomp$loop$prop$unit$18+", index="+e+", codes="+JSON.stringify(g));g=g[0];var h=createSvgElement("g");h.setAttribute("id",f);h.setAttribute("fill",this._line_config[g].color);this._yAxisElement.appendChild(h);f=createSvgElement("text");h.appendChild(f);f.innerHTML=d.$jscomp$loop$prop$unit$18;f.style.fontSize=b+"px";f.setAttribute("y",
b);f.setAttribute("x",(4*e+.5)*b+"px");f=$jscomp.makeIterator(this._get_visible_min_max_for_unit(d.$jscomp$loop$prop$unit$18));var l=f.next().value;f=f.next().value;var k=1.2*b/(this._config.height/(f-l));f=0;var m=void 0;if(.5>k){f=1;for(m=k;.05>m;)f++,m*=10;m=.1>m?.1:.2>m?.2:.5;m/=Math.pow(10,f-1)}else m=Math.ceil(k);if(0===m){console.warn("something is wrong, i can feel it");break}k=this._config.height-b;for(l=Math.floor(l);this._value_to_y_coord(g,l)>k;)l+=m;var n=this._value_to_y_coord(g,l);
k="";for(var q=n,p=void 0,r=4*(e+.15)*b;n>2*b;){p=n;var v=createSvgElement("text");v.innerHTML=this.numberToDisplayText(l,f);v.setAttribute("y",n+.4*b);v.setAttribute("x",r+b/3);v.style.fontSize=b+"px";h.appendChild(v);k+="M "+r+" "+n+" h "+(b/-3).toFixed(2)+" ";l+=m;n=this._value_to_y_coord(g,l)}k+="M "+r+" "+p+" V "+q;f=createSvgElement("path");f.setAttribute("d",k);f.setAttribute("id","yLadder"+g);f.setAttribute("stroke",this._line_config[g].color);h.appendChild(f)}};
Wetplot.prototype._createHoverCursor=function(){var a=this,b=createSvgElement("g");this._svgElement.appendChild(b);b.setAttribute("id","hoverCursor");var c=createSvgElement("path");b.appendChild(c);c.setAttribute("d","M 0 0 V "+this._config.height);document.body.addEventListener("mousemove",function(d){a._cursorMoved(d)})};
Wetplot.prototype._cursorMoved=function(a){var b=document.getElementById("hoverCursor"),c=this._svgElement.getBoundingClientRect();c.x+2<a.clientX&&a.clientX<c.right-2&&c.y+2<a.clientY&&a.clientY<c.bottom-2?(b.style.display="inline",a=a.clientX-c.x,c=a+this._x_offset,b.setAttribute("transform","translate("+c+" 0)"),this._show_values_popup(c,a)):(b.style.display="none",this._hide_values_popup())};
Wetplot.prototype._nearestTwoDataRows=function(a){for(var b=null,c=null,d=this._data.heads.indexOf("Time"),e=0;e<this._data.values.length&&!(b=c,c=this._data.values[e],c[d]>a);e++);return[b,c]};
Wetplot.prototype._show_values_popup=function(a,b){var c=this,d=this._x_coords_to_seconds(a),e=document.getElementById("valuesPopupG"),f=document.getElementById("valuesPopupTime"),g=document.getElementById("valuesPopupBg"),h=function(t){return c._config.font_size_px*t};null==e?(e=createSvgElement("g"),e.setAttribute("id","valuesPopupG"),this._svgElement.appendChild(e),g=createSvgElement("path"),e.appendChild(g),g.style.fill=this._config.hover_box_background_color,g.style.fillOpacity=.75,g.setAttribute("id",
"valuesPopupBg"),f=createSvgElement("text"),f.setAttribute("id","valuesPopupTime"),f.style.fontSize=this._config.font_size_px+"px",e.appendChild(f)):e.style.display="inline";this.getVisibleLineCodes().forEach(function(t){t="valuesPopup"+t;var u=document.getElementById(t);null==u&&(u=createSvgElement("text"),u.style.fontSize=c._config.font_size_px+"px",u.classList.add("valueText"),u.setAttribute("id",t),e.appendChild(u))});var l=h(.25),k=h(1),m=(new Date(1E3*d)).toLocaleString();m=m.substring(0,m.lastIndexOf(":"));
f.innerHTML=getText("TIME")+": "+m;f.setAttribute("y",k);m=f.innerHTML.length;var n=this._seconds_to_values(d,!0);d=e.getElementsByClassName("valueText");for(var q=0;q<d.length;q++){var p=d.item(q),r=p.id.substring(11),v=this._line_config[r].name+": "+Math.round(100*n[r])/100+" "+this._line_config[r].unit;p.innerHTML=v;m=Math.max(m,v.length);p.style.fill=this._line_config[r].color;k+=h(1);p.setAttribute("y",k)}m=2*Math.ceil(m/4.5);k+=h(.25);n=h(this.getVisibleLineCodes().length+1.25);q=(this._config.height+
n)/2;.5<b/this._config.width?(e.setAttribute("transform","translate("+(a-h(m+1))+", "+q+")"),g.setAttribute("transform","")):(e.setAttribute("transform","translate("+a+", "+q+")"),g.setAttribute("transform","rotate(180) translate("+h(-(m+1))+" "+-1*n+")"),l+=h(1));f.setAttribute("x",l);for(a=0;a<d.length;a++)d.item(a).setAttribute("x",l);g.setAttribute("d","M 0 0 H "+h(m)+" V "+.4*k+" L "+h(m+1)+" "+.5*k+" L "+h(m)+" "+.6*k+" V "+k+" H 0 V 0")};
Wetplot.prototype._hide_values_popup=function(){var a=document.getElementById("valuesPopupG");null!==a&&(a.style.display="none")};Wetplot.prototype.getAllLineCodes=function(){return Object.getOwnPropertyNames(this._line_config).filter(function(a){return a!==DEFAULT_LINE_CODE})};Wetplot.prototype.getVisibleLineCodes=function(){var a=this;return this.getAllLineCodes().filter(function(b){return a._line_config[b].visible})};
Wetplot.prototype.numberToDisplayText=function(a,b,c){void 0===c&&(c=a);if(2E3>=c)return a.toFixed(b);b=["","k","m","g","t"];a=_split_to_digits(a);for(c="";4<a.length+(c?1:0);)c=b[b.indexOf(c)+1],5<=a.splice(a.length-3,3)[0]&&(a=_split_to_digits(Number.parseInt(a.join(""))+1));return a.join("")+c};
Wetplot.prototype._get_visible_min_max_for_unit=function(a){var b=this,c=$jscomp.makeIterator([void 0,void 0]),d=c.next().value,e=c.next().value;this.getVisibleLineCodes().forEach(function(f){if(b._line_config[f].unit===a){var g=$jscomp.makeIterator([b._line_config[f].min,b._line_config[f].max]);f=g.next().value;g=g.next().value;void 0===d?(d=f,e=g):(d=Math.min(f,d),e=Math.max(g,e))}});return[d,e]};
Wetplot.prototype._get_visible_units=function(){var a=this,b=[];this.getVisibleLineCodes().forEach(function(c){c=a._line_config[c].unit;-1===b.indexOf(c)&&b.push(c)});return b};Wetplot.prototype._unit_to_id=function(a){for(a=encodeURI(a.replace("\u00b0","deg").replace("%","percent"));-1!==a.indexOf("%");)a=a.replace("%","");return a};Wetplot.prototype.config=function(a,b){void 0!==b&&(this._config[a]=b);return this._config[a]};
Wetplot.prototype.addLine=function(a){if(a===DEFAULT_LINE_CODE)throw Error("invalid lineId");this._line_config[a]=Object.assign({},this._line_config[DEFAULT_LINE_CODE]);this._line_config[a].name=a};Wetplot.prototype.lineConfig=function(a,b,c){void 0!==c&&(this._line_config[a][b]=c);return this._line_config[a][b]};Wetplot.prototype.addWetplotData=function(a){this._addDataToDb("10min",a);this._data=null===this._data?a:WetplotData.concatenate(this._data,a)};
Wetplot.prototype.usePalette=function(a){a=COLOR_PALETTES[a];var b=this.getAllLineCodes();if(a)for(var c=0;c<b.length;c++)this.lineConfig(b[c],"color",a[c%a.length])};
Wetplot.prototype._moveViewBoxPixels=function(a,b){a=void 0===a?0:a;b=void 0===b?!1:b;if(a){var c=$jscomp.makeIterator(this._svgElement.getAttribute("viewBox").split(" ")),d=c.next().value,e=c.next().value,f=c.next().value;c=c.next().value;d=b?a:Number.parseInt(d)+a;this._config.allow_scrolling_to_far||(d=Math.max(0,d),a=this._getXmax()-this._config.width,d=Math.min(d,a));e=[d,e,f,c].join(" ");this._x_offset=d;this._svgElement.setAttribute("viewBox",e)}};
Wetplot.prototype._getXmax=function(){return this._seconds_to_x_coords(this._config.time_offset+this._config.time_length)};
Wetplot.prototype._addPanEventListeners=function(){var a=this,b=this._wrapperElement,c;b.onwheel=function(d){d.preventDefault();a._moveViewBoxPixels(10*d.deltaX);a._moveViewBoxPixels(10*d.deltaY);a._cursorMoved(d)};b.onmousedown=function(d){function e(){document.removeEventListener("mousemove",f);b.onmouseup=null}d.preventDefault();c=d.pageX;var f=function(g){2>=g.pageX||g.pageX-2>window.innerWidth?e():(a._moveViewBoxPixels(c-g.pageX),c=g.pageX)};document.addEventListener("mousemove",f);b.onmouseup=
e}};Wetplot.prototype._seconds_to_x_coords=function(a){return Math.round((a-this._config.time_offset)/this._config.seconds_per_pixel)};Wetplot.prototype._x_coords_to_seconds=function(a){return a*this._config.seconds_per_pixel+this._config.time_offset};Wetplot.prototype._value_to_y_coord=function(a,b){var c=$jscomp.makeIterator(this._get_visible_min_max_for_unit(this._line_config[a].unit));a=c.next().value;c=c.next().value;return this._config.height-(b-a)/(c-a)*this._config.height};
Wetplot.prototype._y_coord_to_value=function(a,b){var c=$jscomp.makeIterator(this._get_visible_min_max_for_unit(this._line_config[a].unit));a=c.next().value;c=c.next().value;return(this._config.height-b)/this._config.height*(c-a)+a};
Wetplot.prototype._seconds_to_values=function(a,b){var c=this;b=void 0===b?!1:b;var d=$jscomp.makeIterator(this._nearestTwoDataRows(a)),e=d.next().value,f=d.next().value,g={};if(null!==e||null!==f){null===e?e=f:null===f&&(f=e);d=this._data.heads.indexOf("Time");var h=e[d],l=(a-h)/(f[d]-h);(b?this.getVisibleLineCodes():this.getAllLineCodes()).forEach(function(k){var m=c._data.heads.indexOf(k),n=e[m];g[k]=n+(f[m]-n)*l})}return g};Wetplot.prototype.scrollTo=function(a){this._moveViewBoxPixels(a,!0)};
Wetplot.prototype.zoomIn=function(){this._config.seconds_per_pixel/=2;this._config.seconds_per_grid_line/=2;this._redraw_all()};Wetplot.prototype.zoomOut=function(){this._config.seconds_per_pixel*=2;this._config.seconds_per_grid_line*=2;this._redraw_all()};Wetplot.prototype.toggleLineVisibility=function(a){this._line_config[a].visible=!this._line_config[a].visible;this._redraw_all()};
Wetplot.prototype._show_buttons=function(){var a=this,b=[];if(this._config.show_line_visibility_button){var c=document.createElement("div");c.setAttribute("id","wetplot-line-toggle-container");c.style.display="none";c.style.position="absolute";c.style.backgroundColor="#cccccccc";this.getAllLineCodes().forEach(function(h){var l=document.createElement("div");l.style.color=a._line_config[h].color;l.setAttribute("id","toggle_"+h);l.innerText="\u2611"+a._line_config[h].name;l.addEventListener("click",
function(k){a.toggleLineVisibility(h);a._line_config[h].visible?(l.style.color=a._line_config[h].color,l.innerText="\u2611"+l.innerText.substring(1)):(l.style.color="#444444",l.innerText="\u25fb"+l.innerText.substring(1));a._redraw_all()});c.appendChild(l)});var d=document.createElement("div");d.innerText="\ud83d\udc41";d.alt=getText("VISIBLE_LINES");d.addEventListener("click",function(h){"none"===c.style.display?(c.style.display="block",h=d.getBoundingClientRect(),c.style.top=h.bottom+h.top+"px",
c.style.left=h.left+"px"):c.style.display="none"});this._wrapperElement.appendChild(c);b.push(d)}if(this._config.show_zoom_buttons){var e=document.createElement("div"),f=document.createElement("div");e.innerText="\u2795";f.innerText="\u2796";e.addEventListener("click",function(h){return a.zoomIn()});f.addEventListener("click",function(h){return a.zoomOut()});b.push(e);b.push(f)}if(0<b.length){var g=document.createElement("div");g.setAttribute("id","wetplot-button-container");g.style.position="absolute";
g.style.display="flex";g.style.flexDirection="row";this._wrapperElement.appendChild(g);b.forEach(function(h){h.classList.add("wetplot-button");g.appendChild(h)})}};
Wetplot.prototype._redraw_all=function(){var a=performance.now(),b=Math.floor(this._config.width/2),c=this._x_coords_to_seconds(this._x_offset+b);this._set_auto_min_max();this._rebuildAllLines();this._redraw_y_axis();this._redraw_x_axis();this._redraw_horizontal_grid();this._moveViewBoxPixels(this._seconds_to_x_coords(c)-b,!0);b=performance.now();console.info("_redraw_all() took "+(b-a)/1E3+"s")};
$jscomp.global.Object.defineProperties(Wetplot.prototype,{data_callback:{configurable:!0,enumerable:!0,get:function(){return this._data_callback},set:function(a){this._data_callback=a}}});var WetplotData=function(a,b){a=void 0===a?[]:a;b=void 0===b?[]:b;this.heads=a;this.values=b};WetplotData.prototype.getValue=function(a,b){return(a=this.values[a])?a[this.getColumnIndex(b)]:void 0};WetplotData.prototype.getColumnIndex=function(a){return this.heads.indexOf(a)};
WetplotData.concatenate=function(a,b){var c=new WetplotData;a.heads.forEach(c.heads.push);b.heads.forEach(function(p){-1===c.heads.indexOf(p)&&c.push(p)});var d=a.getValue(0,"Time"),e=b.getValue(0,"Time"),f=Math.min(d,e);e=d=0;var g={},h={};for(c.heads.forEach(function(p){g[p]=a.getColumnIndex(p);h[p]=b.getColumnIndex(p)});d<a.values.length||e<b.values.length;){var l=a.getValue(d,"Time")-f,k=b.getValue(e,"Time")-f;if(isNaN(k)||l<=k){var m=[],n=a.values[d],q=$jscomp.makeIterator(c.heads);for(f=q.next();!f.done;f=
q.next())m.push(n[g[f.value]]);c.values.push(m);f=a.getValue(d,"Time");d++}if(isNaN(l)||k<=l){l=[];k=b.values[e];m=$jscomp.makeIterator(c.heads);for(f=m.next();!f.done;f=m.next())l.push(k[h[f.value]]);c.values.push(l);f=b.getValue(e,"Time");e++}}return c};WetplotData._add_columns=function(a,b,c){c=void 0===c?null:c;var d=b.length;if(!(0>=d)){for(var e=a.values.length,f=0;f<e;f++)for(var g=0;g<d;g++)a.values[f].push(c);b.forEach(function(h){return a.heads.push(h)})}};
WetplotData.prototype.forEachObject=function(a){var b=this,c={};this.values.forEach(function(d){for(var e=0;e<b.heads.length;e++)c[b.heads[e]]=d[e];a(Object.assign({},c))})};
WetplotData.fromObjectArray=function(a){a=void 0===a?[]:a;var b=new WetplotData;a.forEach(function(c){var d=[];Object.getOwnPropertyNames(c).forEach(function(e){var f=b.heads.indexOf(e);-1===f&&(f=b.heads.length,b.heads.push(e));d[f]=c[e]});b.values.push(d)});b.values.sort(function(c,d){return c.Time>d.Time?1:d.Time>c.Time?-1:0});return b};
WetplotData.prototype.getMinMaxForColumn=function(a){a=void 0===a?0:a;for(var b=void 0,c=void 0,d=0;d<this.values.length;d++){var e=this.values[d][a];if(e<b||void 0===b)b=e;if(e>c||void 0===c)c=e}return[b,c]};
WetplotData.prototype.getMissingTimespans=function(a,b,c,d){d=void 0===d?.5:d;var e=this.getColumnIndex("Time"),f=[],g=this.values[0][e];g-a>c&&f.push([a,g]);g=this.values[this.values.length-1][e];b-g>c&&f.push([g,b]);for(a=1;a<this.values.length-2;a++)b=this.values[a][e],g=this.values[a+1][e],g-b>c&&f.push([b,g]);for(e=0;e<f.length;e++)b=$jscomp.makeIterator(f[e]),a=b.next().value,b=b.next().value,f[e]=[a+d*c,b-d*c];return f};
